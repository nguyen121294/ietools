<!DOCTYPE html>
<html lang="vi" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Line Balancing PRO - IE System</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Shared CSS -->
    <link rel="stylesheet" href="/css/style.css">
    
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body >

<!-- HEADER -->
<div id="header-placeholder"></div>

    <div class="max-w-7xl mx-auto">
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
            <div>
                <h1 class="text-3xl font-bold text-[#137fec]">LINE BALANCING PRO</h1>
                <p class="opacity-60 text-sm">Hệ thống tối ưu hóa năng suất & giả lập độ nhạy sản xuất</p>
            </div>
            <div class="flex gap-2">
                <button onclick="downloadTemplate()" class="ie-button bg-emerald-600 hover:bg-emerald-700">Mẫu Excel</button>
                <button onclick="document.getElementById('excelFile').click()" class="ie-button bg-amber-600 hover:bg-amber-700">Import Excel</button>
                <input type="file" id="excelFile" class="hidden" accept=".xlsx, .xls">
            </div>
        </header>

        <div class="ie-card mb-6">
            <h2 class="ie-card-title">Cấu hình Line</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                    <label class="ie-input-label">Takt Time mục tiêu (s)</label>
                    <input type="number" id="targetTakt" class="ie-input" value="10">
                </div>
                <div>
                    <label class="ie-input-label">Max Tasks / Trạm</label>
                    <input type="number" id="maxTasks" class="ie-input" value="10">
                </div>
                <div>
                    <label class="ie-input-label">Độ biến thiên σ (%)</label>
                    <input type="number" id="sigma" class="ie-input" value="10">
                </div>
                <div class="flex items-end gap-2">
                    <button onclick="addTask()" class="ie-button w-full">+ Thêm Công việc</button>
                </div>
            </div>
        </div>


        <div class="ie-card mb-8 overflow-hidden">
            <div class="overflow-x-auto">
                <table class="task-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Tên công việc</th>
                            <th>Thời gian (s)</th>
                            <th>ID Trước (Pred)</th>
                            <th>ID ghép chung</th>
                            <th>Số máy</th>
                            <th class="text-amber-500">Cycle Time</th> 
                            <th>Hành động</th>  
                        </tr>
                    </thead>
                    <tbody id="taskBody">
                        </tbody>
                </table>
            </div>
            
            <div class="mt-6 flex flex-col md:flex-row gap-4">
                <button onclick="runBalancing('fixed')" class="ie-button flex-1 py-3 text-lg">TÍNH THEO TAKT CỐ ĐỊNH</button>
                <button onclick="runBalancing('auto')" class="ie-button flex-1 py-3 bg-indigo-600 hover:bg-indigo-700">TỰ ĐỘNG TỐI ƯU CÂN BẰNG</button>
                <button id="btnExportResult" onclick="exportResultToExcel()" class="ie-button bg-green-700 hover:bg-green-800 hidden">XUẤT BÁO CÁO EXCEL</button>
                <button onclick="clearAll()" class="ie-button bg-red-600 hover:bg-red-700">Xóa hết</button>
            </div>
        </div>

        <div class="ie-card mb-8">
            <div class="flex justify-between items-center mb-4">
                <h2 class="ie-card-title mb-0">Biểu đồ Yamazumi (Hiện trạng)</h2>
                <button onclick="drawYamazumi()" class="ie-button bg-purple-600 mt-0">Cập nhật biểu đồ</button>
            </div>
            <div class="h-[300px] w-full">
                <canvas id="yamazumiChart"></canvas>
            </div>
        </div>

        <div id="resultsArea" class="space-y-8"></div>

        <div class="max-w-7xl mx-auto mb-12">
            <div class="ie-card bg-slate-800/50 p-6 rounded-xl border border-slate-700/50">
                <h2 class="text-xl font-bold mb-6 text-[#137fec] flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="浸8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Hướng dẫn quy tắc nhập liệu (FAQ)
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
                    <div class="space-y-4">
                        <div>
                            <h4 class="font-bold text-amber-500 mb-1">1. Cột "ID Trước (Pred)" nhập thế nào?</h4>
                            <p class="opacity-70">Nhập ID của công việc phải hoàn thành trước đó. Nếu có nhiều ID, dùng dấu phẩy để ngăn cách (Ví dụ: <code class="bg-slate-900 px-1 rounded">1,2</code>). Để trống nếu là công việc đầu tiên.</p>
                        </div>
                        <div>
                            <h4 class="font-bold text-amber-500 mb-1">2. Cột "ID Ghép Chung" là gì?</h4>
                            <p class="opacity-70">Dùng để ràng buộc các công việc <strong>bắt buộc</strong> phải nằm trong cùng một trạm (do dùng chung đồ gá, máy móc đặc thù...).</p>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <h4 class="font-bold text-[#137fec] mb-1">3. Quy tắc điền "ID Ghép Chung":</h4>
                            <ul class="list-disc ml-4 space-y-2 opacity-70">
                                <li><strong>Để trống:</strong> Tự do. Hệ thống sẽ tự tối ưu vị trí để đạt hiệu suất cao nhất.</li>
                                <li><strong>Điền ID của nhau:</strong> (Ví dụ Task 1 điền "2", Task 2 điền "1"). Hai task này sẽ luôn được xếp chung vào 1 trạm.</li>
                                <li><strong>Điền chính ID của nó:</strong> (Ví dụ Task 5 điền "5"). Công việc này sẽ được khóa đứng <strong>biệt lập một mình một trạm</strong>.</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-bold text-[#137fec] mb-1">4. Tại sao cần nhập "Số máy"?</h4>
                            <p class="opacity-70">Hệ thống sẽ tính <code class="bg-slate-900 px-1 rounded text-amber-500">Cycle Time = Thời gian / Số máy</code>. Nếu một công việc quá dài, hãy tăng số máy để giảm Cycle Time xuống dưới Takt Time.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
            </div>

    <script src="/js/layout.js"></script>
    <script src="balancing_logic.js"></script> 
    <script src="excel_handler.js"></script>
</body>
</html>